{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"C:/django-react/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/django-react/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'../views/Detail.css';import{Link}from'react-router-dom';import{useHistory}from'react-router';function Detail(props){var history=useHistory();// let Today = new Date();\n// let date = Today.getFullYear() + \"-\" + Today.getMonth() + \"-\" + Today.getDate()\nvar pgN=document.location.href.split('/')[4];var _useState=useState({}),_useState2=_slicedToArray(_useState,2),detailList=_useState2[0],setDetailList=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),detailUserInfo=_useState4[0],setDetailUserInfo=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),detailDate=_useState6[0],setDetailDate=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),detailLang=_useState8[0],setDetailLang=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),detailLikedUser=_useState10[0],setDetailLikedUser=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),svgColor=_useState12[0],setSvgColor=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),currnetUser=_useState14[0],setCurrentUser=_useState14[1];useEffect(function(){fetch('http://39.118.174.168:8000/board/'+props.path+pgN+\"/\").then(function(res){return res.json();}).then(function(posts){// console.log(posts)\nsetDetailList(posts);var Y=posts.pub_date.split('-')[0];var M=posts.pub_date.split('-')[1];var D=posts.pub_date.split('-')[2].split('T')[0];setDetailDate(Y+\"년 \"+M+\"월 \"+D+\"일\");setDetailLang(posts.infomation.split(','));setDetailLikedUser(posts.likedUser.split(','));fetch('http://39.118.174.168:8000/api/current_user/',{headers:{Authorization:\"JWT \".concat(localStorage.getItem('token'))}}).then(function(res){return res.json();}).then(function(json){fetch('http://39.118.174.168:8000/api/profile/'+json.id+'/update/',{method:'PATCH',headers:{Authorization:\"JWT \".concat(localStorage.getItem('token'))}}).then(function(res){return res.json();}).then(function(userData){setCurrentUser(userData);});});fetch('http://39.118.174.168:8000/api/profile/'+posts.user_id+'/').then(function(res){return res.json();}).then(function(info){setDetailUserInfo(info);});});},[pgN,props.path]);var DelBoard=function DelBoard(){if(currnetUser.user_id===detailList.user_id){if(window.confirm('정말 삭제하시겠습니까 ?')===true){fetch('http://39.118.174.168:8000/board/'+props.path+pgN+\"/delete/\",{method:'DELETE',headers:{Authorization:\"JWT \".concat(localStorage.getItem('token'))}}).then(function(res){return res.json();}).catch(function(error){return console.error('Error:',error);}).then(function(response){return console.log('Success:',JSON.stringify(response));});window.location.href='/'+props.path;}}else{alert(\"권한이 없습니다.\");}};var UpdateBoard=function UpdateBoard(){detailList.user_id===currnetUser.user_id?history.push(\"/update/\"+pgN):alert(\"권한이 없습니다.\");};var sendData;var handleEffect=function handleEffect(ClickLikeBtn){if(currnetUser.user_id!==null&&currnetUser.user_id!==undefined&&currnetUser.user_id!==\"\"){// detailLikedUser라는 state값이 currentUser.user_pk(접속해있는 유저의 pk값)을 index로 가지고있지 않다면\nif(detailLikedUser.indexOf(currnetUser.user_id+\"\")===-1){//추천\nvar arr=_toConsumableArray(detailLikedUser);arr.push(currnetUser.user_id);var plusUser=arr.join(',');sendData={like:detailList.like+1,likedUser:plusUser};setSvgColor({color:\"black\"});}else{//추천취소\nvar _arr=_toConsumableArray(detailLikedUser);_arr.splice(_arr.indexOf(currnetUser.user_id+\"\"),1);var minusUser=_arr.join(',');sendData={like:detailList.like-1,likedUser:minusUser};setSvgColor({color:\"gray\"});}ClickLikeBtn();}else{alert(\"로그인이 필요합니다.\");window.location.href=\"/login\";}};var ClickLikeBtn=function ClickLikeBtn(){var form_data=new FormData();form_data.append('like',sendData.like);form_data.append('likedUser',sendData.likedUser);fetch('http://39.118.174.168:8000/board/'+props.path+pgN+\"/update/\",{method:'PATCH',headers:{Authorization:\"JWT \".concat(localStorage.getItem('token'))},body:form_data}).then(function(res){return res.json();}).catch(function(error){return console.error('Error:',error);}).then(function(){fetch('http://39.118.174.168:8000/board/'+props.path+pgN+\"/\").then(function(res){return res.json();}).then(function(posts){setDetailList(posts);console.log(posts);setDetailLikedUser(posts.likedUser.split(','));});});};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"detail__container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail__head-wrapper\",children:[/*#__PURE__*/_jsx(\"h1\",{children:detailList.title}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__head-btn\",children:detailList.user_id===currnetUser.user_id?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:UpdateBoard,children:\"\\uC218\\uC815\"}),/*#__PURE__*/_jsx(\"button\",{onClick:DelBoard,children:\"\\uC0AD\\uC81C\"})]}):null}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail__head-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"information\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"detail__head-username\",children:detailList.nickname}),/*#__PURE__*/_jsx(\"span\",{className:\"separator\",children:\"\\xB7\"}),/*#__PURE__*/_jsxs(\"span\",{children:[detailDate,detailList.updateCount===0?null:\"  ·  수정됨\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__head-mobileLike\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"likeBtn\",children:[/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{fill:\"currentColor\",d:\"M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z\"})}),/*#__PURE__*/_jsx(\"span\",{children:detailList.like})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__head-like\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"iCfLcp\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"dtrfkW\",onClick:function onClick(){handleEffect(ClickLikeBtn);},children:/*#__PURE__*/_jsx(\"svg\",{style:svgColor,width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{fill:\"currentColor\",d:\"M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"sc-iyvyFf bJqQCy\",children:detailList.like})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"filetrList\",children:detailLang.map(function(a,i){return/*#__PURE__*/_jsxs(\"p\",{children:[\"#\",a]},i);})}),detailList.image===null?null:/*#__PURE__*/_jsx(\"img\",{src:detailList.image,alt:\"\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__body-wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail__content\",children:/*#__PURE__*/_jsx(\"p\",{dangerouslySetInnerHTML:{__html:detailList.contents}})})}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__footer-wrapper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"detail__writerInfo\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail__topInfo\",children:[/*#__PURE__*/_jsx(Link,{to:\"/mysite/\"+detailList.id,children:/*#__PURE__*/_jsx(\"img\",{src:detailList.profileImage,alt:\"\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__userInfo\",children:/*#__PURE__*/_jsx(\"div\",{className:\"description\",children:detailUserInfo.myInfo})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sc-epnACN eIoWCE\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__buttomInfo\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"detail__comment-wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"detail__comment-width\",children:/*#__PURE__*/_jsx(\"div\",{className:\"margin__top\",children:/*#__PURE__*/_jsx(\"div\",{})})})})]})});}export default Detail;","map":{"version":3,"sources":["C:/django-react/frontend/src/views/Detail.js"],"names":["React","useState","useEffect","Link","useHistory","Detail","props","history","pgN","document","location","href","split","detailList","setDetailList","detailUserInfo","setDetailUserInfo","detailDate","setDetailDate","detailLang","setDetailLang","detailLikedUser","setDetailLikedUser","svgColor","setSvgColor","currnetUser","setCurrentUser","fetch","path","then","res","json","posts","Y","pub_date","M","D","infomation","likedUser","headers","Authorization","localStorage","getItem","id","method","userData","user_id","info","DelBoard","window","confirm","catch","error","console","response","log","JSON","stringify","alert","UpdateBoard","push","sendData","handleEffect","ClickLikeBtn","undefined","indexOf","arr","plusUser","join","like","color","splice","minusUser","form_data","FormData","append","body","title","nickname","updateCount","map","a","i","image","__html","contents","profileImage","myInfo"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport '../views/Detail.css';\r\nimport {Link} from 'react-router-dom';\r\nimport { useHistory } from 'react-router'\r\n\r\nfunction Detail(props){\r\n    const history = useHistory()\r\n    // let Today = new Date();\r\n    // let date = Today.getFullYear() + \"-\" + Today.getMonth() + \"-\" + Today.getDate()\r\n\r\n    let pgN = document.location.href.split('/')[4]\r\n\r\n    let [detailList, setDetailList] = useState({});\r\n    let [detailUserInfo, setDetailUserInfo] = useState({});\r\n    let [detailDate, setDetailDate] = useState();\r\n    let [detailLang, setDetailLang] = useState([]);\r\n\r\n    let [detailLikedUser, setDetailLikedUser] = useState([]);\r\n    let [svgColor, setSvgColor] = useState({});\r\n\r\n    let [currnetUser, setCurrentUser] = useState({});\r\n    \r\n    useEffect(()=>{\r\n        fetch('http://39.118.174.168:8000/board/'+ props.path + pgN + \"/\")\r\n        .then((res)=>res.json())\r\n            .then((posts)=>{\r\n                // console.log(posts)\r\n                setDetailList(posts)\r\n                let Y = posts.pub_date.split('-')[0]\r\n                let M = posts.pub_date.split('-')[1]\r\n                let D = posts.pub_date.split('-')[2].split('T')[0]\r\n                setDetailDate(Y + \"년 \" + M + \"월 \" + D + \"일\")\r\n                setDetailLang(posts.infomation.split(','))\r\n                setDetailLikedUser(posts.likedUser.split(','))\r\n                fetch('http://39.118.174.168:8000/api/current_user/', {\r\n                headers: {\r\n                    Authorization: `JWT ${localStorage.getItem('token')}`\r\n                }\r\n                })\r\n                .then(res => res.json())\r\n                .then(json => {\r\n                fetch('http://39.118.174.168:8000/api/profile/' + json.id + '/update/',{\r\n                        method : 'PATCH',\r\n                        headers: {\r\n                            Authorization: `JWT ${localStorage.getItem('token')}`\r\n                        },\r\n                    })\r\n                    .then((res)=>res.json())\r\n                    .then((userData)=> {\r\n                        setCurrentUser(userData)\r\n                    })\r\n                })  \r\n                fetch('http://39.118.174.168:8000/api/profile/' + posts.user_id + '/')\r\n                .then((res)=>res.json())\r\n                .then((info)=>{\r\n                    setDetailUserInfo(info)\r\n                })\r\n            })\r\n    },[pgN,props.path])\r\n\r\n    const DelBoard = ()=>{\r\n        if(currnetUser.user_id === detailList.user_id){\r\n            if(window.confirm('정말 삭제하시겠습니까 ?')===true){\r\n                fetch('http://39.118.174.168:8000/board/'+ props.path + pgN + \"/delete/\", {\r\n                method : 'DELETE',\r\n                headers: {\r\n                    Authorization : `JWT ${localStorage.getItem('token')}`,\r\n                }\r\n                })\r\n                .then(res => res.json())\r\n                .catch(error => console.error('Error:', error))\r\n                .then(response => console.log('Success:', JSON.stringify(response)));\r\n                window.location.href = '/' + props.path;\r\n            }\r\n        }else{\r\n            alert(\"권한이 없습니다.\")\r\n        }\r\n    }\r\n\r\n    const UpdateBoard = () => {\r\n        detailList.user_id === currnetUser.user_id\r\n        ? history.push(\"/update/\"+pgN)\r\n        : alert(\"권한이 없습니다.\")\r\n    }\r\n\r\n\r\n    let sendData;\r\n    const handleEffect = (ClickLikeBtn) => {\r\n        if(currnetUser.user_id !== null && currnetUser.user_id !== undefined && currnetUser.user_id !== \"\"){\r\n        // detailLikedUser라는 state값이 currentUser.user_pk(접속해있는 유저의 pk값)을 index로 가지고있지 않다면\r\n            if(detailLikedUser.indexOf(currnetUser.user_id + \"\") === -1){ //추천\r\n                let arr = [...detailLikedUser]\r\n                arr.push(currnetUser.user_id)\r\n                let plusUser = arr.join(',')\r\n                sendData = {\r\n                    like : detailList.like + 1,\r\n                    likedUser : plusUser\r\n                }\r\n                setSvgColor({color : \"black\"})\r\n            }else{ //추천취소\r\n                let arr = [...detailLikedUser]\r\n                arr.splice(arr.indexOf(currnetUser.user_id + \"\"), 1)\r\n                let minusUser = arr.join(',')\r\n                 sendData = {\r\n                    like : detailList.like - 1,\r\n                    likedUser : minusUser\r\n                }\r\n                setSvgColor({color : \"gray\"}) \r\n            }\r\n            ClickLikeBtn()\r\n        }else {\r\n            alert(\"로그인이 필요합니다.\")\r\n            window.location.href =\"/login\"\r\n        }\r\n        \r\n    }\r\n\r\n    const ClickLikeBtn = ()=>{\r\n        let form_data = new FormData();\r\n        form_data.append('like', sendData.like);\r\n        form_data.append('likedUser', sendData.likedUser);\r\n\r\n        fetch('http://39.118.174.168:8000/board/'+ props.path + pgN + \"/update/\", {\r\n            method : 'PATCH',\r\n            headers: {\r\n                Authorization : `JWT ${localStorage.getItem('token')}`,\r\n            },\r\n            body : form_data\r\n        })\r\n        .then(res => res.json())\r\n        .catch(error => console.error('Error:', error))\r\n        .then(()=>{\r\n            fetch('http://39.118.174.168:8000/board/'+ props.path + pgN + \"/\")\r\n            .then((res)=>res.json())\r\n            .then((posts)=>{\r\n                setDetailList(posts)\r\n                console.log(posts)\r\n                setDetailLikedUser(posts.likedUser.split(','))\r\n            });\r\n        })\r\n    }    \r\n\r\n    return(\r\n        <>\r\n            <div className=\"detail__container\">\r\n                <div className=\"detail__head-wrapper\">\r\n                    <h1>{detailList.title}</h1>\r\n                    <div className=\"detail__head-btn\">\r\n                        {\r\n                            detailList.user_id === currnetUser.user_id\r\n                            ?(\r\n                                <>\r\n                                <button onClick={UpdateBoard}>수정</button>\r\n                                <button onClick={DelBoard}>삭제</button>\r\n                                </>\r\n                            )\r\n                            : null\r\n                        }\r\n                    </div>\r\n                    <div className=\"detail__head-info\">\r\n                        <div className=\"information\">\r\n                            <span className=\"detail__head-username\">{detailList.nickname}</span>\r\n                            <span className=\"separator\">·</span>\r\n                            <span>{detailDate}{detailList.updateCount === 0 ? null : \"  ·  수정됨\"}</span>\r\n                        </div>\r\n                        <div className=\"detail__head-mobileLike\">\r\n                            <button className=\"likeBtn\">\r\n                                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z\"></path></svg>\r\n                                <span>{detailList.like}</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"detail__head-like\">\r\n                        <div className=\"iCfLcp\">\r\n                            <div className=\"dtrfkW\" onClick={()=>{handleEffect(ClickLikeBtn)}}>\r\n                                <svg style={svgColor} width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M18 1l-6 4-6-4-6 5v7l12 10 12-10v-7z\"></path></svg>\r\n                            </div>\r\n                            <div className=\"sc-iyvyFf bJqQCy\">{detailList.like}</div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"filetrList\">\r\n                    {\r\n                        detailLang.map((a, i)=>{\r\n                            return(\r\n                                <p key={i}>#{a}</p>\r\n                            )\r\n                        })\r\n                    }\r\n                    </div>\r\n                    {\r\n                        detailList.image === null\r\n                        ? null\r\n                        : <img src={detailList.image} alt=\"\"></img>\r\n                    }\r\n                   \r\n                </div>\r\n                <div className=\"detail__body-wrapper\">\r\n                    <div className=\"detail__content\">\r\n                        <p dangerouslySetInnerHTML={{\r\n                            __html: detailList.contents\r\n                        }}></p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"detail__footer-wrapper\">\r\n                    <div className=\"detail__writerInfo\">\r\n                        <div className=\"detail__topInfo\">\r\n                            <Link to={\"/mysite/\" + detailList.id}>\r\n                                <img src={detailList.profileImage} alt=\"\"></img>\r\n                            </Link>\r\n                            <div className=\"detail__userInfo\">\r\n                                <div className=\"description\">{detailUserInfo.myInfo}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"sc-epnACN eIoWCE\"></div>\r\n                        <div className=\"detail__buttomInfo\">\r\n                      \r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"detail__comment-wrapper\">\r\n                    {/* <h4>{commentList.length + reCommentList.length}개의 댓글</h4> */}\r\n                    <div className=\"detail__comment-width\">\r\n                        {/* <div>\r\n                            <textarea ref={commentTxt} defaultValue=\"\" placeholder=\"댓글을 작성하세요\" className=\"comment__textarea\" onChange={(e)=>{setCommentContent(e.target.value)}}></textarea>\r\n                            <div className=\"buttons-wrapper\">\r\n                                <button className=\"comment__btn\" onClick={()=>{CommentEffect(CommentSubmit)}}>댓글 작성</button>\r\n                            </div>\r\n                        </div> */}\r\n                        <div className=\"margin__top\">\r\n                            <div></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\nexport default Detail;"]},"metadata":{},"sourceType":"module"}